<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Ballwurf â€“ Physik Battle</title>
<style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px; line-height: 1.4; }
    #gameOutput { white-space: pre-line; margin-bottom: 20px; }
    #inputField { width: 100%; padding: 10px; font-size: 18px; margin-top: 12px; }
</style>
</head>
<body>

<h2>ðŸŽˆ Physik-Battle: Das groÃŸe Ballwurf-Duell</h2>

<div id="gameOutput"></div>
<input id="inputField" type="text" autofocus onkeydown="if(event.key==='Enter') handleInput()">

<script>
// -------------------------------------------
// --- GAME STATE ----------------------------
// -------------------------------------------
let state = "intro";
let player1 = "";
let player2 = "";
let currentPlayer = "";
let otherPlayer = "";
let awaiting = "";
let xVel = 0;
let yVel = 0;

let level = 0;
let distance = 62;
let heightDiff = 0;
let asciiMode = false;
let ballSize = 1.0; // Luftwiderstand (Multiplikator)

function print(text) {
    document.getElementById("gameOutput").innerText += text + "\n";
}

function clear() {
    document.getElementById("gameOutput").innerText = "";
}

// -------------------------------------------
// --- HELFER -------------------------------
// -------------------------------------------
function chooseBallSize(levelHasAir) {
    if (!levelHasAir) { ballSize = 1.0; return "Im Vakuum gibt es keinen Luftwiderstand."; }

    let r = Math.random();
    if (r < 0.33) { ballSize = 0.97; return "Ihr werft heute einen kleinen Ball â€“ kaum Luftwiderstand."; }
    if (r < 0.66) { ballSize = 0.90; return "Ihr werft heute einen normalen Ball â€“ spÃ¼rbarer Luftwiderstand."; }
    ballSize = 0.70; return "Ihr werft heute einen riesigen Ball â€“ er wird EXTREM abgebremst!";
}

function simulateThrow(x, y, includeAir, includeHeight) {
    let effX = includeAir ? x * ballSize : x;
    let effY = y;

    if (includeHeight) {
        // Effektive y-Beschleunigung je nach Start-HÃ¶he vereinfacht
        effY += heightDiff * 0.5;
    }

    // NÃ¤herungsformel (vereinfacht & spielerisch)
    let time = (effY + Math.sqrt(Math.abs(effY*effY + 4*9.81*effY))) / 9.81;
    if (time < 0.3) time = 0.8 + effY * 0.03;

    let range = effX * time;
    return Math.round(range);
}


// -------------------------------------------
// --- INPUT HANDLER -------------------------
// -------------------------------------------
function handleInput() {
    let input = document.getElementById("inputField").value.trim();
    document.getElementById("inputField").value = "";

    switch(state) {

        // -----------------------------------
        // --- INTRO -------------------------
        // -----------------------------------
        case "intro":
            clear();
            print("Willkommen zum groÃŸen Physik-Battle!\n");
            print("Ihr werft euch mit BÃ„LLEN ab â€“ aber *wissenschaftlich korrekt*.");
            print("Wie kann man sich im Vakuum abwerfen? Ganz einfach:");
            print("Unsere magischen WeltraumbÃ¤lle erzeugen ihren eigenen Mini-Raumzeit-Wirbel.\n");
            print("Sie fliegen also auch dort, wo eigentlich keine Luft ist.\n");
            print("MÃ¶chtet ihr eine ASCII-Flugbahn sehen?");
            print("Schreibt â€žjaâ€œ fÃ¼r Grafikmodus und â€žneinâ€œ fÃ¼r Pro-Modus.");
            state = "chooseAscii";
            return;

        case "chooseAscii":
            asciiMode = (input.toLowerCase() === "ja");
            print("\nGut! Dann starten wir.\n");
            print("Spieler 1, wie heiÃŸt du?");
            state = "askP1";
            return;

        case "askP1":
            player1 = input;
            print("Hallo " + player1 + "!\n");
            print("Spieler 2, wie heiÃŸt du?");
            state = "askP2";
            return;

        case "askP2":
            player2 = input;
            clear();
            print("Super! Willkommen, " + player1 + " und " + player2 + "!\n");
            print("Wir starten jetzt bei **Level 0**:\n");
            print("Level 0 â€“ Vakuum, windstill, keine HÃ¶he. Nur pure Physik.\n");
            print("Los geht's!\n");
            startLevel();
            return;


        // -----------------------------------
        // --- GAMEPLAY ----------------------
        // -----------------------------------
        case "askX":
            xVel = parseFloat(input);
            print(currentPlayer + " hat x = " + xVel + " m/s gewÃ¤hlt.\n");
            print("Jetzt bitte die y-Geschwindigkeit eingeben:");
            state = "askY";
            return;

        case "askY":
            yVel = parseFloat(input);
            print(currentPlayer + " hat y = " + yVel + " m/s gewÃ¤hlt.\n");

            processThrow();
            return;


        // -----------------------------------
        // --- LEVELS MIT VORGEGEBENEM WERT --
        // -----------------------------------
        case "givenY":
            xVel = parseFloat(input);
            print(currentPlayer + " hat x = " + xVel + " m/s gewÃ¤hlt.\n");
            processThrow();
            return;

        case "givenX":
            yVel = parseFloat(input);
            print(currentPlayer + " hat y = " + yVel + " m/s gewÃ¤hlt.\n");
            processThrow();
            return;
    }
}


// -------------------------------------------
// --- LEVEL START ---------------------------
// -------------------------------------------
function startLevel() {
    clear();
    print("ðŸŽ¯ Das Ziel ist " + distance + " m entfernt.");

    // Spieler wechseln
    if (!currentPlayer) {
        currentPlayer = player1;
        otherPlayer = player2;
    } else {
        let temp = currentPlayer;
        currentPlayer = otherPlayer;
        otherPlayer = temp;
    }

    print("\n--- " + currentPlayer + " ist am Zug ---\n");

    switch(level) {
        case 0:
            print("Level 0: Absolutes Vakuum. Keine Luft, kein Wind, keine HÃ¶he.");
            print("MagiebÃ¤lle funktionieren trotzdem. VerrÃ¼ckt, oder?");
            print("\nBitte gib die x-Geschwindigkeit deines Wurfs ein:");
            state = "askX";
            return;

        case 1:
            print("Level 1: PlÃ¶tzlichâ€¦ LUFT!");
            print(chooseBallSize(true));
            print("\nBitte gib x-Geschwindigkeit ein:");
            state = "askX";
            return;

        case 2:
            heightDiff = 0;
            print("Level 2: Die Luft wird wieder abgesaugt â€“ Vakuum!");
            print("ABER: Der Boden ist plÃ¶tzlich hÃ¶her oder tieferâ€¦");
            heightDiff = Math.floor(Math.random()*20 - 10);
            print("HÃ¶henunterschied: " + heightDiff + " m.");
            print("\nBitte gib x-Geschwindigkeit ein:");
            state = "askX";
            return;

        case 3:
            print("Level 3: Der Computer gibt euch einen Wert vor!");
            let r = Math.random();
            if (r < 0.5) {
                yVel = Math.floor(Math.random()*12 + 4);
                print("\nDer Computer hat die y-Geschwindigkeit bereits fixiert: y = " + yVel);
                print("Du musst nur die richtige x-Geschwindigkeit wÃ¤hlen!");
                state = "givenY";
            } else {
                xVel = Math.floor(Math.random()*20 + 10);
                print("\nDer Computer hat die x-Geschwindigkeit bereits fixiert: x = " + xVel);
                print("Du musst nur die richtige y-Geschwindigkeit wÃ¤hlen!");
                state = "givenX";
            }
            return;

        case 4:
            print("Level 4: Luftwiderstand + Vorgabewert! Chaos pur.");
            print(chooseBallSize(true));
            let r2 = Math.random();
            if (r2 < 0.5) {
                yVel = Math.floor(Math.random()*12 + 5);
                print("\nComputer fixiert y = " + yVel);
                print("Du musst die passende x-Geschwindigkeit finden!");
                state = "givenY";
            } else {
                xVel = Math.floor(Math.random()*25 + 10);
                print("\nComputer fixiert x = " + xVel);
                print("Du musst die passende y-Geschwindigkeit finden!");
                state = "givenX";
            }
            return;
    }
}



// -------------------------------------------
// --- AUSWERTUNG ----------------------------
// -------------------------------------------
function processThrow() {

    let includeAir = (level === 1 || level === 4);
    let includeHeight = (level === 2);

    let landed = simulateThrow(xVel, yVel, includeAir, includeHeight);

    let diff = landed - distance;

    if (diff === 0) {
        print("\nðŸŽ‰ TREFFER! Perfekt!");
        level++;
        if (level > 4) {
            print("\nIhr habt ALLE Level geschafft!");
            print("Grandios! Physik-MeisterInnen!");
            return;
        }
        print("\nWeiter geht's zu Level " + level + "!");
        startLevel();
        return;
    }

    if (diff > 0) print("\nâ†’ Der Ball flog " + diff + " m zu weit.");
    else print("\nâ†’ Der Ball war " + Math.abs(diff) + " m zu kurz.");

    // Spielerwechsel
    let temp = currentPlayer;
    currentPlayer = otherPlayer;
    otherPlayer = temp;

    print("\n--- " + currentPlayer + " ist dran ---");
    startLevel();
}

</script>
</body>
</html>
