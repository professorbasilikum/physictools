<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Physik-Battle</title>
<style>
    body {
        background-color: black;
        color: #00ff00;
        font-family: "Courier New", monospace;
        padding: 20px;
        white-space: pre-line;
    }
    #inputField {
        width: 100%;
        padding: 10px;
        font-size: 18px;
        margin-top: 12px;
        background: black;
        color: #00ff00;
        border: 2px solid #00ff00;
        font-family: "Courier New", monospace;
    }
</style>
</head>
<body>

<div id="gameOutput"></div>
<input id="inputField" type="text" autofocus onkeydown="if(event.key==='Enter') handleInput()">

<script>
// ----------------------------
// GAME STATE
// ----------------------------
let state = "intro";
let player1 = "";
let player2 = "";
let currentPlayer = "";
let otherPlayer = "";

let xVel = 0;
let yVel = 0;

let level = 1;
let pointsP1 = 0;
let pointsP2 = 0;

let distance = 50;
let heightDiff = 0;

let givenX = null;
let givenY = null;

let airFactor = 1.0;
let ballText = "";

let output = document.getElementById("gameOutput");

function print(t) {
    output.innerText += t + "\n";
}

function clear() {
    output.innerText = "";
}

// Ballgr√∂√üen: 97% / 90% / 70%
function chooseBall(levelHasAir) {
    if (!levelHasAir) {
        airFactor = 1.0;
        ballText = "Im Vakuum ‚Äì kein Luftwiderstand.";
        return;
    }
    let r = Math.random();
    if (r < 0.33) {
        airFactor = 0.97;
        ballText = "Ihr bekommt einen kleinen Ball (wenig Luftwiderstand).";
    } else if (r < 0.66) {
        airFactor = 0.90;
        ballText = "Ihr bekommt einen normalen Ball (mittelstarker Luftwiderstand).";
    } else {
        airFactor = 0.70;
        ballText = "Ihr bekommt einen RIESENBALL (massiver Luftwiderstand)!";
    }
}

// Sehr einfache Wurfweite, damit das Spiel spielerisch bleibt
function simulateThrow(x, y, hasAir, hasHeight) {
    let effX = hasAir ? x * airFactor : x;
    let effY = hasHeight ? (y + heightDiff * 0.05) : y;

    let time = Math.max(0.5, effY / 5);
    let range = effX * time;

    return Math.round(range);
}

function startLevel() {
    clear();

    distance = Math.floor(Math.random() * 91) + 10; // 10-100m

    // Spieler wechseln
    if (!currentPlayer) {
        currentPlayer = player1;
        otherPlayer = player2;
    } else {
        [currentPlayer, otherPlayer] = [otherPlayer, currentPlayer];
    }

    print("=========================================");
    print(" LEVEL " + level);
    print("=========================================\n");

    print("Die Zielentfernung betr√§gt: " + distance + " m.\n");

    // LEVELBESCHREIBUNGEN
    switch(level) {
        case 1:
            chooseBall(false);
            print("Szene: Ihr steht auf einer vollkommen ruhigen Ebene im leeren Raum.");
            print("Magieb√§lle funktionieren auch im Vakuum!");
            print(ballText);
            print("\nBitte gib x-Geschwindigkeit ein:");
            state = "askX";
            break;

        case 2:
            chooseBall(true);
            print("Szene: Ein leichter Windhauch‚Ä¶ und pl√∂tzlich ist √ºberall Luft!");
            print("Der Ball wird nun abgebremst.");
            print(ballText);
            print("\nBitte gib x-Geschwindigkeit ein:");
            state = "askX";
            break;

        case 3:
            chooseBall(false);
            heightDiff = Math.floor(Math.random()*21 - 10);
            print("Szene: Ihr steht auf einem Turm und werft den Ball hinunter‚Ä¶ oder hinauf!");
            print("H√∂henunterschied: " + heightDiff + " m.");
            print(ballText);
            print("\nBitte gib x-Geschwindigkeit ein:");
            state = "askX";
            break;

        case 4:
            chooseBall(false);
            if (Math.random() < 0.5) {
                givenY = Math.floor(Math.random()*46 + 5);
                print("Der Computer sagt: Die y-Geschwindigkeit ist fix: y = " + givenY + " m/s.");
                print("Finde die passende x-Geschwindigkeit!");
                state = "askX_forcedY";
            } else {
                givenX = Math.floor(Math.random()*46 + 5);
                print("Der Computer sagt: Die x-Geschwindigkeit ist fix: x = " + givenX + " m/s.");
                print("Finde die passende y-Geschwindigkeit!");
                state = "askY_forcedX";
            }
            break;

        case 5:
            chooseBall(true);
            if (Math.random() < 0.5) {
                givenY = Math.floor(Math.random()*46 + 5);
                print("Wind, Luft ‚Äì und der Computer fixiert y = " + givenY + ".");
                state = "askX_forcedY";
            } else {
                givenX = Math.floor(Math.random()*46 + 5);
                print("Wind, Luft ‚Äì und der Computer fixiert x = " + givenX + ".");
                state = "askY_forcedX";
            }
            break;

        case 6:
            chooseBall(false);
            heightDiff = Math.floor(Math.random()*21 - 10);
            if (Math.random() < 0.5) {
                givenY = Math.floor(Math.random()*46 + 5);
                print("Ihr seid wieder auf einem Turm ‚Äì diesmal ‚ÄûW√ºrfe mit Vorgabe‚Äú!");
                print("Der Computer fixiert y = " + givenY + ".");
                print("H√∂henunterschied: " + heightDiff + " m.");
                state = "askX_forcedY";
            } else {
                givenX = Math.floor(Math.random()*46 + 5);
                print("Ihr seid wieder auf einem Turm ‚Äì diesmal ‚ÄûW√ºrfe mit Vorgabe‚Äú!");
                print("Der Computer fixiert x = " + givenX + ".");
                print("H√∂henunterschied: " + heightDiff + " m.");
                state = "askY_forcedX";
            }
            break;
    }

    print("\n--- " + currentPlayer + " ist am Zug ---");
}

function resolveThrow(x, y, hasAir, hasHeight) {
    let landed = simulateThrow(x, y, hasAir, hasHeight);
    let diff = landed - distance;

    if (diff === 0) {
        print("\nüí• TREFFER! Punkt f√ºr " + currentPlayer + "!");

        if (currentPlayer === player1) pointsP1 += level;
        else pointsP2 += level;

        print("\nPunktestand:");
        print(player1 + ": " + pointsP1 + " Punkte");
        print(player2 + ": " + pointsP2 + " Punkte\n");

        level++;
        if (level > 6) {
            print("\nüéâ Alle Level abgeschlossen!");
            return;
        }
        startLevel();
        return;
    }

    if (diff > 0)
        print("\n‚Üí Der Ball war " + diff + " m zu WEIT.");
    else
        print("\n‚Üí Der Ball war " + Math.abs(diff) + " m zu KURZ.");

    // Spielerwechsel
    [currentPlayer, otherPlayer] = [otherPlayer, currentPlayer];
    print("\n--- " + currentPlayer + " ist dran ---");
}

function handleInput() {
    let input = document.getElementById("inputField").value.trim();
    document.getElementById("inputField").value = "";

    switch(state) {
        case "intro":
            clear();
            print("WILLKOMMEN ZUM PHYSIK-BATTLE!\n");
            print("Ihr werft euch B√§lle zu ‚Äì oder eher: Ihr versucht euch GEZIELT zu treffen!");
            print("Jedes Level hat andere physikalische Bedingungen.");
            print("Wer trifft, bekommt Punkte (Levelnummer = Punkte).");
            print("Wer am Ende mehr Punkte hat, gewinnt!\n");
            print("Spieler 1: Wie hei√üt du?");
            state = "askP1";
            break;

        case "askP1":
            player1 = input;
            print("\nHallo " + player1 + "!");
            print("Spieler 2: Wie hei√üt du?");
            state = "askP2";
            break;

        case "askP2":
            player2 = input;
            clear();
            print("Willkommen " + player1 + " und " + player2 + "!");
            startLevel();
            break;

        // Normale Eingabe: x und y
        case "askX":
            xVel = parseFloat(input);
            print(currentPlayer + " w√§hlt x = " + xVel);
            print("Jetzt y:");
            state = "askY";
            break;

        case "askY":
            yVel = parseFloat(input);
            print(currentPlayer + " w√§hlt y = " + yVel);

            let hasAir = (level === 2 || level === 5);
            let hasHeight = (level === 3 || level === 6);

            resolveThrow(xVel, yVel, hasAir, hasHeight);
            break;

        // Vorgegeben: y ist fix
        case "askX_forcedY":
            xVel = parseFloat(input);
            print(currentPlayer + " w√§hlt x = " + xVel);

            resolveThrow(xVel, givenY, level===5, level===6);
            givenY = null;
            break;

        // Vorgegeben: x ist fix
        case "askY_forcedX":
            yVel = parseFloat(input);
            print(currentPlayer + " w√§hlt y = " + yVel);

            resolveThrow(givenX, yVel, level===5, level===6);
            givenX = null;
            break;
    }
}

</script>
</body>
</html>
