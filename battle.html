<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Galaktisches Ball-Duell</title>
  <style>
    body {
      font-family: monospace;
      background: #111;
      color: #0f0;
      padding: 20px;
      line-height: 1.5;
    }
    #input {
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      width: 100%;
      margin-top: 12px;
      padding: 8px;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <div id="log"></div>
  <input id="input" placeholder="Eingabe..." autofocus />

  <script>
    const log = document.getElementById('log');
    const input = document.getElementById('input');

    // ZustÃ¤nde
    let phase = 'intro';
    let player1 = '', player2 = '', currentPlayer = '';
    let level = 0;
    let distance = 0, vx = 0;
    let physics = {};

    function println(text) {
      log.innerHTML += text + "<br>";
      window.scrollTo(0, document.body.scrollHeight);
    }

    function nextLevel() {
      level++;
      if (level > 4) {
        println("ðŸŽ‰ Ihr habt alle Level geschafft! Fantastisch geworfen!");
        input.disabled = true;
        return;
      }
      println(`<br>ðŸŒ Level ${level} startet!`);
      describeLevel();
      startRound();
    }

    function describeLevel() {
      switch (level) {
        case 0:
          println("LVL 0: Vakuum, Windstille, kein HÃ¶henunterschied.");
          println("Wie kann man sich im Vakuum mit BÃ¤llen abwerfen? Nun â€“ diese BÃ¤lle sind aus purer Fantasie-Energie. Sie brauchen keine Luft, nur Vorstellungskraft!");
          break;
        case 1:
          println("LVL 1: Jetzt gibt es Luft wie auf der Erde! Die BÃ¤lle werden ein bisschen gebremst.");
          break;
        case 2:
          physics.wind = (Math.random() * 10 - 5);
          println(`LVL 2: Wind kommt ins Spiel! Windgeschwindigkeit: ${physics.wind.toFixed(1)} m/s.`);
          break;
        case 3:
          physics.heightDiff = Math.floor(Math.random() * 21 - 10);
          println(`LVL 3: HÃ¶henunterschied! Der Gegner steht ${physics.heightDiff} m ${physics.heightDiff > 0 ? 'hÃ¶her' : 'tiefer'}.`);
          break;
        case 4:
          physics.wind = (Math.random() * 10 - 5);
          physics.heightDiff = Math.floor(Math.random() * 21 - 10);
          println(`LVL 4: Alles auf einmal! Luft, Wind (${physics.wind.toFixed(1)} m/s) und HÃ¶henunterschied (${physics.heightDiff} m).`);
          break;
      }
    }

    function startRound() {
      distance = Math.floor(Math.random() * 60 + 40);
      println(`<br>Das Ziel ist ${distance} m entfernt.`);
      currentPlayer = player1;
      println(`--- ${currentPlayer} ist am Zug ---`);
      println(`${currentPlayer}, gib bitte die x-Geschwindigkeit deines Wurfs an:`);
      phase = 'vx';
    }

    input.addEventListener('keydown', e => {
      if (e.key !== 'Enter') return;
      const val = input.value.trim();
      input.value = '';

      if (phase === 'intro') {
        println("Willkommen beim *Galaktischen Ball-Duell!*");
        println("Hier treten zwei tapfere Ballwerfer gegeneinander an. Ziel: den anderen mit einem Wurf zu treffen!");
        println("Ihr startet bei Level 0 â€“ Vakuum, keine Luft, kein Wind, kein HÃ¶henunterschied.");
        println("Bitte gib den Namen von Spieler 1 ein:");
        phase = 'name1';
      }

      else if (phase === 'name1') {
        player1 = val || "Spieler 1";
        println(`Hallo ${player1}!`);
        println("Bitte gib den Namen von Spieler 2 ein:");
        phase = 'name2';
      }

      else if (phase === 'name2') {
        player2 = val || "Spieler 2";
        println(`Super! ${player1} und ${player2} sind bereit!`);
        println("<br>Dann los â€“ die BÃ¤lle warten schon!");
        level = 0;
        physics = {};
        describeLevel();
        startRound();
      }

      else if (phase === 'vx') {
        vx = parseFloat(val);
        if (isNaN(vx)) return println("Bitte gib eine Zahl ein.");
        println(`${currentPlayer} hat x = ${vx} m/s gewÃ¤hlt.`);
        println("Jetzt y-Geschwindigkeit eingeben:");
        phase = 'vy';
      }

      else if (phase === 'vy') {
        const vy = parseFloat(val);
        if (isNaN(vy)) return println("Bitte gib eine Zahl ein.");
        println(`${currentPlayer} hat y = ${vy} m/s gewÃ¤hlt.`);

        // Berechnung
        const g = 9.81;
        let range;
        let h = physics.heightDiff || 0;
        let wind = physics.wind || 0;

        // Luftwiderstand vereinfacht â€“ nur leichte Verringerung
        const dragFactor = (level >= 1) ? 0.97 : 1.0;

        // Flugzeit (vereinfacht, BerÃ¼cksichtigung HÃ¶henunterschied)
        const t = (vy + Math.sqrt(vy * vy + 2 * g * Math.max(0, h))) / g * 2;
        range = (vx * t + wind * t * 0.3) * dragFactor;

        const diff = Math.round(range - distance);

        println(`â†’ Der Ball flog ${Math.abs(diff)} m ${diff > 0 ? 'zu weit' : 'zu kurz'}.`);

        if (Math.abs(diff) < 2) {
          println(`ðŸŽ¯ Treffer! ${currentPlayer} hat gewonnen!`);
          nextLevel();
        } else {
          // Spieler wechseln
          currentPlayer = (currentPlayer === player1) ? player2 : player1;
          println(`<br>--- ${currentPlayer} ist dran ---`);
          println(`${currentPlayer}, gib bitte die x-Geschwindigkeit deines Wurfs an:`);
          phase = 'vx';
        }
      }
    });
  </script>
</body>
</html>
