<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Magischer Wurfkampf</title>
<style>
    body {
        background-color: black;
        color: #00ff00;
        font-family: "Consolas", monospace;
        padding: 20px;
        white-space: pre-wrap;
    }
    input {
        font-size: 20px;
        margin-top: 10px;
        padding: 5px;
        background: #002200;
        border: 2px solid #00ff00;
        color: #00ff00;
    }
</style>
</head>
<body>

<div id="game"></div>
<input id="inputField" autocomplete="off">

<script>
/* =========================================================
   GLOBALE VARIABLEN
   ========================================================= */

let g = 9.81;
let players = [];
let currentPlayer = 0;
let level = 1;
let awaiting = "intro";
let inputField = document.getElementById("inputField");
let game = document.getElementById("game");

let xGiven = null;
let yGiven = null;

let distanceToTarget = 0;
let heightDifference = 0;

let ballSize = ""; 
let dragFactor = 1.0;

let scores = [0, 0]; // Punkte der Spieler

/* =========================================================
   HILFSFUNKTIONEN
   ========================================================= */

function log(t){
    game.innerHTML += t + "\n";
    window.scrollTo(0, document.body.scrollHeight);
}

function coinFlip(){
    return Math.random() < 0.5 ? 0 : 1;
}

/* Ballgr√∂√üen */
function chooseBall(){
    let r = Math.random();
    if(r < 0.33){
        ballSize = "kleinen Ball";
        dragFactor = 0.97;
    } else if(r < 0.66){
        ballSize = "mittleren Ball";
        dragFactor = 0.90;
    } else {
        ballSize = "riesigen Ball";
        dragFactor = 0.70;
    }
}

/* Distanz 10‚Äì100 m */
function chooseDistance(){
    distanceToTarget = Math.floor(Math.random()*91)+10;
}

/* H√∂henunterschied */
function chooseHeight(){
    heightDifference = Math.floor(Math.random()*31) - 15; // -15 bis +15 m
}

/* Physik: vereinfachte Reichweite */
function computeRange(vx, vy, drag, height){
    // Flugzeit abh√§ngig von H√∂he
    let time;

    if(height === 0){
        // Normaler Wurf
        time = (2 * vy) / g;
        if(time < 0) time = 0;
    } else {
        // Wurf mit H√∂henunterschied
        // Formel: y(t)= vy*t - 0.5*g*t¬≤ = -height
        // ‚Üí t = (vy + sqrt(vy¬≤ + 2*g*height)) / g
        let disc = vy*vy + 2*g*(height);
        if(disc < 0) return 0;
        time = (vy + Math.sqrt(disc)) / g;
    }

    if(time < 0) time = 0;

    // Drag wirkt nur auf x
    let effectiveVX = vx * drag;

    return effectiveVX * time;
}

/* Startet ein Level komplett neu */
function startLevel(){
    game.innerHTML += "\n===============================\n";
    game.innerHTML += "             LEVEL " + level + "\n";
    game.innerHTML += "===============================\n\n";

    chooseBall();
    chooseDistance();

    let starter = coinFlip();
    currentPlayer = starter;

    /* Szenen / Einstellungen je Level */
    switch(level){

        case 1:
            heightDifference = 0;
            dragFactor = 1.0;
            log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
            log("Szene: Ihr steht auf einer ruhigen Ebene, im v√∂lligen Vakuum.");
            log("Magieb√§lle funktionieren auch im luftleeren Raum!");
            log("Kein Luftwiderstand.\n");
            log("Zieldistanz: " + distanceToTarget + " m");
            log("Ihr werft einen " + ballSize + " (Drag ignoriert, da Vakuum).\n");
        break;

        case 2:
            heightDifference = 0;
            log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
            log("Szene: Ein m√§chtiger Windgeist erwacht ‚Äì √ºberall Luft!");
            log("Mit Luftwiderstand!\n");
            log("Zieldistanz: " + distanceToTarget + " m");
            log("Ihr werft einen " + ballSize + " (Drag: " + Math.round(dragFactor*100) + "%)\n");
        break;

        case 3:
            chooseHeight();
            dragFactor = 1.0; // Luftleer!
            log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
            log("Szene: Ihr steht auf einem hohen Turm ‚Äì alles ist wieder luftleer!");
            log("Kein Luftwiderstand.\n");
            log("H√∂henunterschied: " + heightDifference + " m");
            log("Zieldistanz: " + distanceToTarget + " m");
            log("Ihr werft einen " + ballSize + " (Drag ignoriert).\n");
        break;

        case 4:
            heightDifference = 0;
            dragFactor = 1.0;
            xGiven = null; yGiven = null;
            if(Math.random() < 0.5){
                xGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Ein mystischer Automat stellt die horizontale Geschwindigkeit ein!");
                log("Du musst y selbst w√§hlen.\n");
                log(" Vorgegeben: x = " + xGiven + " m/s");
            } else {
                yGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Ein magischer Stein schubst euren Ball genau mit einer bestimmten H√∂he!");
                log("Du musst x selbst w√§hlen.\n");
                log(" Vorgegeben: y = " + yGiven + " m/s");
            }
            log("\nKein Luftwiderstand.");
            log("Zieldistanz: " + distanceToTarget + " m\n");
        break;

        case 5:
            heightDifference = 0;
            xGiven = null; yGiven = null;
            if(Math.random() < 0.5){
                xGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Windige Arena! Der Automat stellt x ein, du w√§hlst y.\n");
                log(" Vorgegeben: x = " + xGiven + " m/s");
            } else {
                yGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Windige Arena! Ein Zauber setzt y, du w√§hlst x.\n");
                log(" Vorgegeben: y = " + yGiven + " m/s");
            }
            log("Mit Luftwiderstand! Drag: " + Math.round(dragFactor*100) + "%");
            log("Zieldistanz: " + distanceToTarget + " m\n");
        break;

        case 6:
            chooseHeight();
            dragFactor = 1.0; // H√∂he, aber Vakuum!
            xGiven = null; yGiven = null;
            if(Math.random() < 0.5){
                xGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Auf einem Turm! x ist vorgegeben, du w√§hlst y.\n");
                log(" Vorgegeben: x = " + xGiven + " m/s");
            } else {
                yGiven = Math.floor(Math.random()*46)+5;
                log("Eine M√ºnze entscheidet... " + players[currentPlayer] + " beginnt!\n");
                log("Szene: Auf einem Turm! y ist vorgegeben, du w√§hlst x.\n");
                log(" Vorgegeben: y = " + yGiven + " m/s");
            }
            log("Kein Luftwiderstand.");
            log("H√∂henunterschied: " + heightDifference + " m");
            log("Zieldistanz: " + distanceToTarget + " m\n");
        break;
    }

    requestX();
}

/* =========================================================
   EINGABE-ABFRAGEN
   ========================================================= */

function requestX(){
    let p = players[currentPlayer];
    log("\n--- " + p + " ist am Zug ---");
    if(xGiven !== null){
        log("x ist vorgegeben: " + xGiven + " m/s");
        requestY();
        return;
    }
    log(p + ", gib x-Geschwindigkeit ein:");
    awaiting = "x";
}

function requestY(){
    let p = players[currentPlayer];
    if(yGiven !== null){
        log("y ist vorgegeben: " + yGiven + " m/s");
        evaluateThrow();
        return;
    }
    log("Jetzt y:");
    awaiting = "y";
}

/* =========================================================
   WURF AUSWERTEN
   ========================================================= */

function evaluateThrow(){

    let p = players[currentPlayer];

    let vx = (xGiven !== null ? xGiven : xInput);
    let vy = (yGiven !== null ? yGiven : yInput);

    log(p + " hat gew√§hlt:  x=" + vx + " m/s   y=" + vy + " m/s\n");

    let dist = computeRange(vx, vy, dragFactor, heightDifference);

    let diff = Math.round(dist - distanceToTarget);

    if(diff === 0){
        log("üéØ PERFEKTER TREFFER!");
        scores[currentPlayer] += level;
        nextLevel();
        return;
    }

    if(diff < 0){
        log("‚Üí Der Ball war " + Math.abs(diff) + " m zu KURZ.\n");
    } else {
        log("‚Üí Der Ball war " + diff + " m zu WEIT.\n");
    }

    // Spielerwechsel
    currentPlayer = (currentPlayer === 0 ? 1 : 0);
    requestX();
}

/* =========================================================
   LEVEL WECHSEL
   ========================================================= */

function nextLevel(){
    level++;
    if(level > 6){
        log("\n=== SPIEL ENDE ===");
        log(players[0] + ": " + scores[0] + " Punkte");
        log(players[1] + ": " + scores[1] + " Punkte");
        return;
    }
    startLevel();
}

/* =========================================================
   EINGABE LOGIK
   ========================================================= */

let xInput = 0;
let yInput = 0;

inputField.addEventListener("keydown", function(e){
    if(e.key === "Enter"){
        let val = inputField.value.trim();
        inputField.value = "";

        if(awaiting === "intro"){
            // Erkl√§rung sichtbar, jetzt Namen abfragen
            log("Willkommen beim Magischen Wurfkampf!\n");
            log("Hier duelliert ihr euch mit magischen B√§llen,\ndie je nach Level anders fliegen.");
            log("Manchmal herrscht Vakuum, manchmal Wind,\nmanchmal steht ihr auf einem Turm.\n");
            log("Gebt jetzt eure Namen ein.\n");
            log("Spieler 1:");
            awaiting = "p1";
            return;
        }

        if(awaiting === "p1"){
            players[0] = val;
            log("Hallo " + val + "!\nSpieler 2:");
            awaiting = "p2";
            return;
        }

        if(awaiting === "p2"){
            players[1] = val;
            log("Hallo " + val + "!");
            awaiting = null;
            startLevel();
            return;
        }

        if(awaiting === "x"){
            xInput = parseFloat(val);
            if(isNaN(xInput)) {
                log("Bitte eine Zahl eingeben.");
                return;
            }
            requestY();
            return;
        }

        if(awaiting === "y"){
            yInput = parseFloat(val);
            if(isNaN(yInput)) {
                log("Bitte eine Zahl eingeben.");
                return;
            }
            evaluateThrow();
            return;
        }
    }
});

/* FIRST START */
log("Dr√ºcke ENTER, um zu beginnen.");
</script>
</body>
</html>
